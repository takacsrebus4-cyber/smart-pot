<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlantMonitor Pro | Smart Plant Monitoring</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>

    </style>
</head>

<body>
    <div id="dashboard" class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <span>PlantMonitor Pro</span>
            </div>
            <ul class="nav-links">
                <li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#"><i class="fas fa-leaf"></i> My Plants</a></li>
                <li><a href="#"><i class="fas fa-chart-line"></i> Analytics</a></li>
                <li><a href="#"><i class="fas fa-bell"></i> Alerts</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
                <li><a href="#"><i class="fas fa-question-circle"></i> Help</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1>Plant Dashboard</h1>
                <div class="user-info">
                    <div class="notification-icon">
                        <i class="fas fa-bell fa-lg"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-avatar">
                        <i class="fas fa-user-circle fa-2x"></i>
                    </div>
                </div>
            </header>

            <!-- Stats Overview -->
            <section class="stats-overview">
                <div class="stat-card">
                    <i class="fas fa-leaf fa-2x" style="color: var(--primary-green);"></i>
                    <div class="stat-value">12</div>
                    <div class="stat-label">Total Plants</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-tint fa-2x" style="color: var(--primary-green);"></i>
                    <div class="stat-value">8</div>
                    <div class="stat-label">Need Watering</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-temperature-high fa-2x" style="color: var(--primary-green);"></i>
                    <div class="stat-value">3</div>
                    <div class="stat-label">Temperature Alerts</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-heart fa-2x" style="color: var(--primary-green);"></i>
                    <div class="stat-value">9</div>
                    <div class="stat-label">Healthy Plants</div>
                </div>
            </section>

            <!-- Plants Grid -->
            <section>
                <h2 class="section-title">My Plants</h2>
                <div class="plants-grid">
                    <!-- Plant Card 1 -->
                    <div class="plant-card">
                        <div class="plant-header">
                            <h3 class="plant-name">Monstera Deliciosa</h3>
                            <span class="plant-status status-healthy">Healthy</span>
                        </div>
                        <div class="plant-metrics">
                            <div class="metric">
                                <div class="metric-value">72°F</div>
                                <div class="metric-label">Temperature</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">65%</div>
                                <div class="metric-label">Humidity</div>
                            </div>
                        </div>
                        <div class="mb-1">
                            <div class="metric-label">Soil Moisture</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 70%"></div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="metric-label">Light Exposure</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 85%"></div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary"><i class="fas fa-tint"></i> Water</button>
                            <button class="btn btn-primary"><i class="fas fa-chart-line"></i> Details</button>
                        </div>
                    </div>

                    <!-- Plant Card 2 -->
                    <div class="plant-card caution">
                        <div class="plant-header">
                            <h3 class="plant-name">Snake Plant</h3>
                            <span class="plant-status status-caution">Needs Water</span>
                        </div>
                        <div class="plant-metrics">
                            <div class="metric">
                                <div class="metric-value">68°F</div>
                                <div class="metric-label">Temperature</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">60%</div>
                                <div class="metric-label">Humidity</div>
                            </div>
                        </div>
                        <div class="mb-1">
                            <div class="metric-label">Soil Moisture</div>
                            <div class="progress-bar">
                                <div class="progress-fill caution" style="width: 25%"></div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="metric-label">Light Exposure</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 45%"></div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary"><i class="fas fa-tint"></i> Water</button>
                            <button class="btn btn-primary"><i class="fas fa-chart-line"></i> Details</button>
                        </div>
                    </div>

                    <!-- Plant Card 3 -->
                    <div class="plant-card warning">
                        <div class="plant-header">
                            <h3 class="plant-name">Fiddle Leaf Fig</h3>
                            <span class="plant-status status-warning">High Temp</span>
                        </div>
                        <div class="plant-metrics">
                            <div class="metric">
                                <div class="metric-value" style="color: var(--warning);">89°F</div>
                                <div class="metric-label">Temperature</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">75%</div>
                                <div class="metric-label">Humidity</div>
                            </div>
                        </div>
                        <div class="mb-1">
                            <div class="metric-label">Soil Moisture</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%"></div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="metric-label">Light Exposure</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 70%"></div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary"><i class="fas fa-tint"></i> Water</button>
                            <button class="btn btn-primary"><i class="fas fa-chart-line"></i> Details</button>
                        </div>
                    </div>

                    <!-- Plant Card 4 -->
                    <div class="plant-card">
                        <div class="plant-header">
                            <h3 class="plant-name">Peace Lily</h3>
                            <span class="plant-status status-healthy">Healthy</span>
                        </div>
                        <div class="plant-metrics">
                            <div class="metric">
                                <div class="metric-value">70°F</div>
                                <div class="metric-label">Temperature</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">80%</div>
                                <div class="metric-label">Humidity</div>
                            </div>
                        </div>
                        <div class="mb-1">
                            <div class="metric-label">Soil Moisture</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <div class="metric-label">Light Exposure</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%"></div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary"><i class="fas fa-tint"></i> Water</button>
                            <button class="btn btn-primary"><i class="fas fa-chart-line"></i> Details</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section class="analytics-section">
                <h2 class="section-title">Plant Health Analytics</h2>
                <div class="chart-container">
                    <p><i class="fas fa-chart-bar fa-3x mb-2"></i></p>
                    <p>Plant Health Metrics Visualization</p>
                </div>
            </section>
        </main>
    </div>

    <div id="id01" class="modal">
        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">×</span>
        <form class="modal-content" action="/action_page.php">
            <div class="container">
                <h1>Your access token ha expired</h1>
                <p>Would you like to refresh it?</p>

                <div class="clearfix">
                    <button type="button" onclick="document.getElementById('id01').style.display='none'"
                        class="yesbtn">Yes</button>
                    <button type="button" onclick="document.getElementById('id01').style.display='none'"
                        class="nobtn">No</button>
                </div>
            </div>
        </form>
    </div>

    <div id ="userinfo" class="userinfo-modal">
        <span onclick="document.getElementById('userinfo').style.display='none'" class="close" title="Close Modal">×</span>
        <div class="user-info-content">
            <h2>User Profile</h2>
            <p>Name: John Doe</p>
            <p>Email:abc@gmail.com</p>
        </div>
    </div>

    <script>
        // Simple script for interactive elements
        document.addEventListener('DOMContentLoaded', function () {
            // Water button functionality
            const waterButtons = document.querySelectorAll('.btn-secondary');
            waterButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const plantCard = this.closest('.plant-card');
                    const plantName = plantCard.querySelector('.plant-name').textContent;
                    alert(`Watering scheduled for ${plantName}`);

                    // Simulate watering effect
                    const progressFill = plantCard.querySelector('.progress-fill');
                    progressFill.style.width = '85%';

                    // Update status if it was caution
                    if (plantCard.classList.contains('caution')) {
                        plantCard.classList.remove('caution');
                        const status = plantCard.querySelector('.plant-status');
                        status.textContent = 'Healthy';
                        status.className = 'plant-status status-healthy';
                    }
                });
            });

            // Notification bell
            const notificationIcon = document.querySelector('.notification-icon');
            notificationIcon.addEventListener('click', function () {
                alert('You have 3 alerts:\n- Snake Plant needs water\n- Fiddle Leaf Fig temperature high\n- Calathea humidity low');
            });
        });

        /*document.getElementById("user-avatar").addEventListener("click", function () {
            document.getElementById("userinfo").style.display = 'block';
        });*/


        document.getElementById("dashboard").addEventListener("click", function (evt) {
            fetch('http://127.0.0.1:5000/posts', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + JSON.parse(localStorage.getItem('accessToken')),
                    'Connention': 'keep-alive',
                    'Accept': '*/*',
                    'Accept-Encoding': 'gzip, deflate, br',
                    'User-Agent': 'Microsoft Edge/141.0.3537.99, Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/'
                },
                body: null,
            }).then(res => res.json()).then(response => {
                if (response.tokenValid === false) {
                    if (response.refreshTokenValid === false) {
                        window.location.href = "./login.html";
                    }
                    else {
                        document.getElementById('id01').style.display = 'block';
                    }
            }
        });
        });

        document.getElementById("nobtn").addEventListener("click", function () {
            window.location.href = "./login.html";
        });

        document.getElementById("yesbtn").addEventListener("click", function () {
            fetch('http://localhost:3000/refreshToken', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ token: JSON.parse(localStorage.getItem('refreshToken')) }),
            }).then(res => res.json()).then(response => {
                console.log(response);
                localStorage.clear();
                localStorage.setItem("accessToken", JSON.stringify(response.accessToken));
                localStorage.setItem("refreshToken", JSON.stringify(response.refreshToken));
            });
        });
    </script>
</body>

</html>